---
title: "Suicide Rates Overview 1985-2016"
author: "Khalil Hijazi"
date: "5/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

How commmon is suicide nowadays in comparison to a few decades ago? Which age and gender groups is suicide more prevalent? What factors prove to be leading causes of suicide? More importantly, how can we use this information to better prevent this problem? Using this [Kaggle Dataset](https://www.kaggle.com/russellyates88/suicide-rates-overview-1985-to-2016 "Suicide Rates Overview 1985 to 2016") as well as general principles of data science, we can appropriately address these questions and many more. First, I will demonstrate how to collect the data and put it into a machine-readable form. Next, I will show you how to process the data and do some exploratory analysis and visualization in order to come up with hypotheses about the data. Finally, I will show you how to test these hypotheses using machine learning.

## Required Tools

I will be using R 3.6.0 to carry out this analysis. Aside from that, here is a list of the libraries I'll be using:

* [tidyverse](https://www.tidyverse.org/ "Tidyverse")
* [magrittr](https://magrittr.tidyverse.org/ "magrittr")
* [ggplot2](https://ggplot2.tidyverse.org/ "ggplot2")

Lastly, if you plan on following this guide, you will need to download the [Kaggle Dataset](https://www.kaggle.com/russellyates88/suicide-rates-overview-1985-to-2016 "Suicide Rates Overview 1985 to 2016"). **Note:** If you do not already have a Kaggle account, you will be required to create one to receive permission to download the dataset.

## 1. Getting Started

Let's first start by downloading the data. I downloaded the data as a CSV (comma separated values) file and stored it under the **data** subdirectory. 

Now, I will load the CSV file into a form that I can manipulate using R. To do so, I will use the **read_csv** function from the **tidyverse** package. It's important to note that R uses rectangular grid data structures for storing data called data frames. In a data frame, each row corresponds to an entity and each of the columns is an attribute for the entities across the table. That being said, the *read_csv* function takes the dataset CSV file and loads it into a data frame, which we can then easily work with in R. For more information on the **tidyverse** package and its features, feel free to check out this [resource](https://www.tidyverse.org/ "Tidyverse").

```{r load_data, message=FALSE}
library(tidyverse)
# loading data into data frame
file_path <- "data/master.csv"
suicide_data <- read_csv(file_path)
# printing first ten rows of data frame
suicide_data %>% slice(1:10)
```

### 1.1 Observing the Data

We now have a data frame called **suicide_data** that has all our data. Here, we can see the basic attributes our entities will share such as country, year, sex, age, and other factors related to each suicide instance. Any missing data is assigned a value of NA.

One last thing to note is that attributes can come in a variety of data types, but there are five main types (categorical, numeric, datetime, geolocation, and other). An attribute can only belong to one type (i.e. if it is categorical, it cannot be numeric unless represented otherwise). If it is a categorical attribute, then it must be either ordered or unordered. Categorically ordered attributes are ones that contain a fixed set of values that have some importance paradigm. Categorically unordered attributes on the other hand are the exact opposite in the sense that there is no significance to the values other than the fact that they are different values. Similarly, if an attribute is numerical, it can either be discrete or continuous. I won't go into depth of how this conclusion is arrived at but the general rule of thumb is that discrete numerical attributes are typically countable whereas continuous aren't.

Here are some examples from our dataset:

* 'country' | categorical unordered | Takes a value from a finite set of countries |
* 'suicides_no' | numeric discrete | Takes a value from a finite set of numeric integer suicide counts |
* 'suicides/100k pop' | numeric continuous | Takes a value from an infinite set of ratios of suicides to 100k populations |

### 1.2 Tidying the Data

Taking a look at the data, some modifications are needed for the purpose of our operations on that data. For instance, certain columns aren't necessary and can be deleted and more importantly, some attributes' datatypes need to be changed to other datatypes that are more suitable to the computations they'll be involved in.

I'll first start by removing the unnecessary columns. I'll be removing the 'country-year' attribute because that is simply a concatenation of the first two attributes and thus isn't necessary. I'll also be removing the 'HDI for year' attribute because there's just not much data on it. Lastly, I'll remove the 'generation' attribute because it is simply an encoding of the 'age' attribute, and thus we only need one of the two.

```{r remove_unnecessary_columns, comment=NA, message=F}
drops <- c("country-year", "HDI for year", "generation") # attributes to be dropped
suicide_data[drops] <- NULL # dropping the collection of attributes from suicide_data data frame
suicide_data
```

Now that I've removed the unnecesssary columns, it's time to modify certain datatypes to our advantage. First, I'll change the 'year', 'suicides_no', 'population', and 'gdp_per_capita (\$)' attributes to integer columns instead of doubles. Although, the attribute 'gdp_for_year (\$)' is not a fractional number, I will leave it as a double because some of its entries are far too large to be represented as integer values in R.

**Note:** Here, I make use of the [magrittr](https://magrittr.tidyverse.org/ "magrittr") package. This package allows me to use the **%<>%** operation which is similar to the **%>%** dplyr operation, except that this one reassigns the data frame to whatever is resulted of the pipeline operations. So in this case, suicide_data is being modified once the columns have been mutated from doubles to integers.s

```{r modify_datatypes, comment+NA, message=F}
library(magrittr)
int_cols <- c('year', 'suicides_no', 'population', 'gdp_per_capita ($)') # attributes to convert to integers

suicide_data[int_cols] %<>%
  mutate_all(as.integer) # modifying all the selected columns in int_cols from double datatype to integer

suicide_data
```

There are other methods of tidying data, such as uniting columns into one column or separating columns into multiple columns (we could've done this with the country-year column but it was easier to remove it since we already had two separate columns for country and year). Just because these methods weren't used, that doesn't mean they aren't important; it just means that they weren't needed for this dataset. As a data scientist, it is up to you to decide when certain methods are necessary and when not.

## 2. Exploratory Data Analysis

Now that we've tidyed up the data frame, we can start performing a variety of analyses on it. The goal of these analyses is to learn more about our data and possible notice some trends or patterns in the data and thereby be able to confidently make testable hypotheses. We will perform these analyses:

* Group-based Visualizations
*
*
*

To make some of these analyses possible, we will be using the library [ggplot2](https://ggplot2.tidyverse.org/ "ggplot2") which enables us to make interactive plots for the purpose of visualizing trends across various attributes. There are multiple plots and graphs offered by this library such as scatter plots, violin plots, histograms, bar graphs, and so on and so forth. In case you wanted to learn more about each of these, this [cheat sheet](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf "ggplot2 Cheat Sheet") is worth looking at.

### 2.1 Group-based Visualizations

We have a variety of groups in our data frame and we would like to see if there are some trends among those groups. That is, we would like to see whether or not a certain group (i.e. year, country, sex, age, etc.) has some overall effect on suicide count. Since our data is laid out in the form of suicide overviews per individual country at a certain year, we will need to group by certain attributes to make this trend measurement possible.

#### 2.1.1 Suicide Count Across Time

Here, we will group by the year. That way, we will create a group for each year in our data frame. In each of those groups, we will have all the records of suicide counts in that year, regardless of other factors such as age, sex, and country.

```{r trend_over_time, comment=NA, message=F}
library(ggplot2)

suicide_data %>%
  group_by(year) %>% # grouping by each year
  summarize(mean_suicide_count = mean(suicides_no)) %>% # computing mean suicide incidents per year
  ggplot(aes(x=factor(year), y=mean_suicide_count, group=1)) +
  geom_point() + # plotting points
  geom_line() + # plotting line across points 
  scale_y_continuous(breaks = seq(0, 300, by = 25)) + # setting range for the mean suicide count values
  labs(title="Average Suicide Count Per Year", # decorating graph with axes titles as well as graph title
       x = "Year",
       y = "Average Suicide Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # formatting x axis labels by putting years at an angle
```

From this graph, we can tell that suicide count depends on the year attribute. Although this may seem obvious, it is good practice to often check for this type of information. We can also see that in earlier years of the data (i.e. 1985-1994), the average suicide count per year was increasing for the most part and in the later years (i.e. 1995 - 2014), the average suicide count per year decreased quite a bit. Unfortunately, it also spiked up quite a bit in 2015. Lastly, we can tell that the data for 2016 is either skewed due to very little information or we just did extremely well at lowering the average suicide count per year by approximately 175 incidents.

#### 2.1.2 Suicide Count Per Sex Group Across Time

Similar to 2.1.1, we will first group by the year. However, now we are also subgrouping a second time based on sex affiliation. By doing so, we will have all the records of suicide counts for a given sex group for each year, regardless of other factors such as age, sex, and country.

```{r trend_across_sex_over_time, comment=NA, message=F}
suicide_data %>%
  group_by(year, sex) %>% # grouping by each year and then by sex
  summarize(mean_suicide_count = mean(suicides_no)) %>% # computing mean suicide incidents per year per sex group
  ggplot(aes(x=factor(year), y=mean_suicide_count, group=sex)) +
  geom_point(aes(color=sex)) + # plotting points
  geom_line(aes(color=sex)) + # plotting line across points 
  scale_y_continuous(breaks = seq(0, 500, by = 50)) + # setting range for the mean suicide count values
  labs(title="Average Suicide Count Per Sex Group Across Time", # adding graph title plus axes titles
       x = "Year",
       y = "Average Suicide Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # formatting x axis labels by putting years at an angle
```

Based on this graph, we can tell for sure that males tend to have higher suicide incidents than do females. For each of the years (excluding 2016), there's a huge difference in the average number of suicide incidents per each group, and this trend has been consistent over time, which makes it very likely to be true that suicide is generally more prevalent among males than females. We also now have confirmed that suicide counts are dependent on gender (i.e. they are not constant across gender groups).